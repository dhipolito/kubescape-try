name: Kubescape scanning for misconfigurations
on: [push, pull_request]
jobs:
  kubescape:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
      # - name: install Kubescape
      #   run: |
      #     curl -s https://raw.githubusercontent.com/kubescape/kubescape/master/install.sh | /bin/bash
      #     kubescape scan  framework all  ./templates --format sarif --output results
      # - uses: kubescape/github-action@main
      #   continue-on-error: true
      #   with:
      #     format: sarif
      #     files: ./templates/*.yaml
      #     outputFile: results.sarif
      #     verbose: true
      # # Optional: Specify the Kubescape cloud account ID
      # account: ${{secrets.KUBESCAPE_ACCOUNT}}
      # # Optional: Scan a specific path. Default will scan the whole repository
      # files: "examples/*.yaml"
      - run: head -n 50 test.sarif
      - name: Upload Kubescape scan results to Github Code Scanning
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: test.sarif
